<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial (intermediate): Hosting experiments online • psychTestR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial (intermediate): Hosting experiments online">
<meta property="og:description" content="psychTestR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">psychTestR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.23.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a1-simple-demo.html">Demos</a>
    </li>
    <li>
      <a href="../articles/a2-research-examples.html">Research examples</a>
    </li>
    <li>
      <a href="../articles/b-introduction.html">An introduction to psychTestR</a>
    </li>
    <li>
      <a href="../articles/c-media-files.html">Tutorial (basic): Media files</a>
    </li>
    <li>
      <a href="../articles/c-modularisation.html">Tutorial (basic): Modularisation</a>
    </li>
    <li>
      <a href="../articles/d-automated-testing.html">Tutorial (intermediate): Automated testing</a>
    </li>
    <li>
      <a href="../articles/d-building-custom-page-types.html">Tutorial (intermediate): Building custom page types</a>
    </li>
    <li>
      <a href="../articles/d-editing-dictionaries.html">Tutorial (intermediate): Editing dictionaries</a>
    </li>
    <li>
      <a href="../articles/d-hosting-experiments-online.html">Tutorial (intermediate): Hosting experiments online</a>
    </li>
    <li>
      <a href="../articles/d-randomisation.html">Tutorial (intermediate): Randomising item administration</a>
    </li>
    <li>
      <a href="../articles/d-url-parameters.html">Tutorial (intermediate): URL parameters</a>
    </li>
    <li>
      <a href="../articles/e-internationalised-questionnaire.html">Tutorial (expert): Creating an internationalised questionnaire</a>
    </li>
    <li>
      <a href="../articles/e-jspsych-integration.html">Tutorial (expert): jsPsych integration</a>
    </li>
    <li>
      <a href="../articles/z_Anthony_Chmiel_video_tutorials.html">Video series: An introduction to psychTestR, by Anthony Chmiel</a>
    </li>
    <li>
      <a href="../articles/z_code_for_article_in_musik_und_internet.html">Code for Article 'psychTestR - Ein R-Paket für (musik-) psychologische Tests und Fragebogeninventare'</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pmcharrison/psychTestR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="d-hosting-experiments-online_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tutorial (intermediate): Hosting experiments online</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pmcharrison/psychTestR/blob/HEAD/vignettes/d-hosting-experiments-online.Rmd" class="external-link"><code>vignettes/d-hosting-experiments-online.Rmd</code></a></small>
      <div class="hidden name"><code>d-hosting-experiments-online.Rmd</code></div>

    </div>

    
    
<p>psychTestR experiments can be hosted online using the open-source ‘Shiny Server’ software. This software can be installed on a Linux server. The following instructions detail how you can provision your own server if you don’t already have one.</p>
<p><strong>Note:</strong> <a href="https://www.westernsydney.edu.au/marcs/our_team/researchers/dr_anthony_chmiel" class="external-link">Anthony Chmiel</a> has very kindly put together a much more detailed guide that is available <a href="https://s3-eu-west-1.amazonaws.com/research.pmcharrison.com/psychTestR/psychTestR-server-docs-latest.pdf" class="external-link">here</a>. You are highly recommended to refer to this guide when setting up your own server.</p>
<div class="section level2">
<h2 id="shiny-server">Shiny Server<a class="anchor" aria-label="anchor" href="#shiny-server"></a>
</h2>
<p><a href="https://www.rstudio.com/products/shiny/shiny-server/" class="external-link">Shiny Server</a> hosts <a href="https://www.rstudio.com/products/shiny/" class="external-link">Shiny</a> apps so that they can be accessed over the Internet. psychTestR delivers experiments as Shiny apps, and therefore needs Shiny Server for deploying experiments online.</p>
<p>Shiny Server has a <a href="https://www.rstudio.com/products/shiny/download-server/" class="external-link">free open source version</a> and a <a href="https://www.rstudio.com/products/shiny-server-pro/" class="external-link">paid professional version</a>. While the professional version comes with useful features, in particular sophisticated load management, it seems to be prohibitively expensive for research purposes. We’ve used the open source version in our own work, and have had no problems.</p>
</div>
<div class="section level2">
<h2 id="provisioning-a-server-with-shiny-server">Provisioning a server with Shiny Server<a class="anchor" aria-label="anchor" href="#provisioning-a-server-with-shiny-server"></a>
</h2>
<p>Shiny Server requires a Linux server. There are various ways of obtaining your own server. Cloud-based providers, such as <a href="https://aws.amazon.com/" class="external-link">Amazon Web Services</a> (AWS), provide a useful way of getting your own virtual server instead of having to buy and maintain physical hardware. The instructions below correspond to AWS because this is where our experience lies, but there are many competing cloud providers that could equivalently be used.</p>
<p>The overview of this stage is as follows:</p>
<ul>
<li>Spin up an <a href="https://aws.amazon.com/ec2" class="external-link">Elastic Compute Cloud</a> server (typically <code>t2.micro</code> should be sufficient for installation and development purposes, the server can be temporarily upgraded to larger sizes (e.g. <code>t2.medium</code>) during data collection).</li>
<li>Install R and Shiny Server.</li>
</ul>
<p>Instructions covering both of these steps can be found here: <a href="https://aws.amazon.com/blogs/big-data/running-r-on-aws/" class="external-link uri">https://aws.amazon.com/blogs/big-data/running-r-on-aws/</a>. This link provides some additional functionality that you may not need, such as setting up a web-hosted instance of RStudio, and integrating the server with S3. However, it also provides a CloudFormation template that automates the setup of this configuration, so it still might save you time.</p>
<p>The following instructions may also be useful:</p>
<ul>
<li><a href="https://gist.github.com/sestelo/abdf9693cc3172078a519447fe51f899" class="external-link uri">https://gist.github.com/sestelo/abdf9693cc3172078a519447fe51f899</a></li>
<li><a href="https://www.edgarsdatalab.com/2016/08/25/setup-a-shiny-server-in-aws/" class="external-link uri">https://www.edgarsdatalab.com/2016/08/25/setup-a-shiny-server-in-aws/</a></li>
<li><a href="https://www.rstudio.com/products/shiny/download-server/" class="external-link uri">https://www.rstudio.com/products/shiny/download-server/</a></li>
</ul>
<p>By default, Shiny Server runs on port 3838. We’ve found this problematic when testing participants in schools, because some firewalls block this port. We therefore recommend running Shiny Server on port 80. You can achieve this as follows:</p>
<ul>
<li>SSH to the server.</li>
<li>Open the Shiny Server configuration file: <code>sudo nano /etc/shiny-server/shiny-server.conf</code>.</li>
<li>Replace the line that says <code>listen 3838;</code> with <code>listen 80;</code>.</li>
<li>Restart Shiny Server: <code>sudo restart shiny-server</code>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="install-psychtestr">Install psychTestR<a class="anchor" aria-label="anchor" href="#install-psychtestr"></a>
</h2>
<p>You can install psychTestR on your server as follows:</p>
<ul>
<li>SSH to the server.</li>
<li>Enter the following command into the terminal, to start R: <code>sudo R</code>
</li>
<li>Run the following command at the R terminal:</li>
</ul>
<pre><code><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"pmcharrison/psychTestR"</span><span class="op">)</span></code></pre>
</div>
<div class="section level2">
<h2 id="debugging">Debugging<a class="anchor" aria-label="anchor" href="#debugging"></a>
</h2>
<div class="section level3">
<h3 id="sanitised-error-messages">Sanitised error messages<a class="anchor" aria-label="anchor" href="#sanitised-error-messages"></a>
</h3>
<p>Shiny defaults to sanitised error messages, which is often not desirable. We recommend disabling error sanitisation as follows:</p>
<ul>
<li>SSH to the server.</li>
<li>Open Shiny’s configuration file: <code>sudo nano /etc/shiny-server/shiny-server.conf</code>.</li>
<li>Add the line <code>sanitize_errors off;</code> in the obvious place.</li>
<li>Save and quit <code>nano</code>.</li>
<li>Restart Shiny Server: <code>sudo restart shiny-server</code>.</li>
</ul>
</div>
<div class="section level3">
<h3 id="debugging-tips">Debugging tips<a class="anchor" aria-label="anchor" href="#debugging-tips"></a>
</h3>
<ul>
<li>Develop your test locally before pushing it to the server.</li>
<li>When developing locally, run <code>options(shiny.error = browser)</code> so you can inspect the stack when an error occurs.</li>
<li>When running a test on the server, error messages often go to the Javascript console. On Chrome, you can access this console by clicking View -&gt; Developer -&gt; Javascript console.</li>
<li>Errors that happen remotely but not locally typically come from psychTestR lacking write permissions to your app’s folder (see below instructions), or from the necessary R packages not being installed on the server. You can install R packages on the server by SSHing in, opening R (<code>sudo R</code>), and then running the same commands as you would on your local machine (e.g. <code>install.packages("car")</code>).</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="hosting-an-experiment">Hosting an experiment<a class="anchor" aria-label="anchor" href="#hosting-an-experiment"></a>
</h2>
<p>Your experiment’s source code should already be in the form of a directory containing the file <code>app.R</code>, which should contain the logic for defining your experiment. You should upload this directory to the directory <code>/srv/shiny-server/</code>. Our recommended approach is currently as follows:</p>
<ul>
<li>Store your experiment’s source code in a <a href="https://git-scm.com/" class="external-link">Git</a> repository, hosted online by a service like <a href="https://github.com/" class="external-link">Github</a>, <a href="https://bitbucket.org/" class="external-link">Bitbucket</a>, or <a href="https://gitlab.com/" class="external-link">Gitlab</a>.</li>
<li>SSH to the server.</li>
<li>Navigate to the target directory: <code>cd /srv/shiny-server</code>
</li>
<li>Download your source code from Git to this directory: <code>sudo git clone https://user@bitbucket.org/user/repo.git</code> (see your Git host for exact details)</li>
<li>This should create a new directory containing your application. The name will correspond to the name of your Github repository. You can rename it using <code>mv old_name new_name</code>.</li>
<li>psychTestR needs to have permission to write temporary files into your app’s directory; this is where the results will be stored, for example. You therefore need to run <code>sudo chown -R shiny app_folder_name</code> to give the Shiny process write permission.</li>
<li>Your app should be now available at <code>http://www.your-server.org:3838/app_name</code>, or if you changed the port to 80, <code>http://www.your-server.org/app_name</code>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="local-files">Local files<a class="anchor" aria-label="anchor" href="#local-files"></a>
</h2>
<p>psychTestR stores local files in the <code>output/</code> subdirectory of your app’s directory. These include session files and saved data. Do not delete these files unless you are happy with losing data. We recommend using the app’s admin panel to delete these files if necessary.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Peter Harrison.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.4.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
