<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial (basic): Modularisation • psychTestR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial (basic): Modularisation">
<meta property="og:description" content="psychTestR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">psychTestR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.19.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a1-simple-demo.html">Demos</a>
    </li>
    <li>
      <a href="../articles/a2-research-examples.html">Research examples</a>
    </li>
    <li>
      <a href="../articles/b-introduction.html">An introduction to psychTestR</a>
    </li>
    <li>
      <a href="../articles/c-media-files.html">Tutorial (basic): Media files</a>
    </li>
    <li>
      <a href="../articles/c-modularisation.html">Tutorial (basic): Modularisation</a>
    </li>
    <li>
      <a href="../articles/d-automated-testing.html">Tutorial (intermediate): Automated testing</a>
    </li>
    <li>
      <a href="../articles/d-building-custom-page-types.html">Tutorial (intermediate): Building custom page types</a>
    </li>
    <li>
      <a href="../articles/d-editing-dictionaries.html">Tutorial (intermediate): Editing dictionaries</a>
    </li>
    <li>
      <a href="../articles/d-hosting-experiments-online.html">Tutorial (intermediate): Hosting experiments online</a>
    </li>
    <li>
      <a href="../articles/d-randomisation.html">Tutorial (intermediate): Randomising item administration</a>
    </li>
    <li>
      <a href="../articles/d-url-parameters.html">Tutorial (intermediate): URL parameters</a>
    </li>
    <li>
      <a href="../articles/e-internationalised-questionnaire.html">Tutorial (expert): Creating an internationalised questionnaire</a>
    </li>
    <li>
      <a href="../articles/e-jspsych-integration.html">Tutorial (expert): jsPsych integration</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pmcharrison/psychTestR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tutorial (basic): Modularisation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pmcharrison/psychTestR/blob/master/vignettes/c-modularisation.Rmd"><code>vignettes/c-modularisation.Rmd</code></a></small>
      <div class="hidden name"><code>c-modularisation.Rmd</code></div>

    </div>

    
    
<div id="about" class="section level2">
<h2 class="hasAnchor">
<a href="#about" class="anchor"></a>About</h2>
<p>Modularisation is a key feature of psychTestR. By parcelling your code into reusable components, you can make your implementations quicker to write, easier to read, easier to maintain, and easier to use. This tutorial discusses a few strategies for modularisation in psychTestR.</p>
</div>
<div id="functions" class="section level2">
<h2 class="hasAnchor">
<a href="#functions" class="anchor"></a>Functions</h2>
<p>The function is the basic unit of modularisation in computer programming. A function takes a set of inputs, performs some operation upon them, and (optionally) returns an output:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">f</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">person</span>, <span class="no">fruit</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"Greetings, %s. Would you like some %s?"</span>,
          <span class="no">person</span>, <span class="no">fruit</span>)
}

<span class="fu">f</span>(<span class="kw">person</span> <span class="kw">=</span> <span class="st">"fellow researcher"</span>,
  <span class="kw">fruit</span> <span class="kw">=</span> <span class="st">"apples"</span>)</pre></body></html></div>
<pre><code>## [1] "Greetings, fellow researcher. Would you like some apples?"</code></pre>
<p>When creating psychTestR tests, functions are useful for creating series of test elements that all share a common schema. For example, suppose we wanted to ask someone about their preferences for different kinds of fruit. We could write our code like this:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="../reference/join.html">join</a></span>(
  <span class="fu"><a href="../reference/NAFC_page.html">NAFC_page</a></span>(
    <span class="st">"apples"</span>,
    <span class="st">"How much do you like apples, on a scale from 1 (not at all) to 7 (lots?)"</span>,
    <span class="kw">choices</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fl">1</span>:<span class="fl">7</span>),
    <span class="kw">arrange_vertically</span> <span class="kw">=</span> <span class="fl">FALSE</span>
  ),
  <span class="fu"><a href="../reference/NAFC_page.html">NAFC_page</a></span>(
    <span class="st">"pears"</span>,
    <span class="st">"How much do you like pears, on a scale from 1 (not at all) to 7 (lots?)"</span>,
    <span class="kw">choices</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fl">1</span>:<span class="fl">7</span>),
    <span class="kw">arrange_vertically</span> <span class="kw">=</span> <span class="fl">FALSE</span>
  ),
  <span class="fu"><a href="../reference/NAFC_page.html">NAFC_page</a></span>(
    <span class="st">"plums"</span>,
    <span class="st">"How much do you like plums, on a scale from 1 (not at all) to 7 (lots?)"</span>,
    <span class="kw">choices</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fl">1</span>:<span class="fl">7</span>),
    <span class="kw">arrange_vertically</span> <span class="kw">=</span> <span class="fl">FALSE</span>
  ),
  <span class="fu"><a href="../reference/NAFC_page.html">NAFC_page</a></span>(
    <span class="st">"apricots"</span>,
    <span class="st">"How much do you like apricots, on a scale from 1 (not at all) to 7 (lots?)"</span>,
    <span class="kw">choices</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fl">1</span>:<span class="fl">7</span>),
    <span class="kw">arrange_vertically</span> <span class="kw">=</span> <span class="fl">FALSE</span>
  ),
  <span class="fu"><a href="../reference/NAFC_page.html">NAFC_page</a></span>(
    <span class="st">"pineapples"</span>,
    <span class="st">"How much do you like pineapples, on a scale from 1 (not at all) to 7 (lots?)"</span>,
    <span class="kw">choices</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fl">1</span>:<span class="fl">7</span>),
    <span class="kw">arrange_vertically</span> <span class="kw">=</span> <span class="fl">FALSE</span>
  ),
  <span class="fu"><a href="../reference/NAFC_page.html">NAFC_page</a></span>(
    <span class="st">"cherries"</span>,
    <span class="st">"How much do you like cherries, on a scale from 1 (not at all) to 7 (lots?)"</span>,
    <span class="kw">choices</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fl">1</span>:<span class="fl">7</span>),
    <span class="kw">arrange_vertically</span> <span class="kw">=</span> <span class="fl">FALSE</span>
  ),
)</pre></body></html></div>
<p>Clearly this is very inefficient: almost all the code is copy-pasted from page to page. This code is slow to read because it takes up so much space, and slow to maintain, because any change to the general schema needs to be repeated six times.</p>
<p>Functions provide a much better way to do this. Consider the following:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">ask_liking</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">fruit</span>) {
  <span class="fu"><a href="../reference/NAFC_page.html">NAFC_page</a></span>(
    <span class="no">fruit</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"How much do you like %s, on a scale from 1 (not at all) to 7 (lots?)"</span>,
            <span class="no">fruit</span>),
    <span class="kw">choices</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fl">1</span>:<span class="fl">7</span>),
    <span class="kw">arrange_vertically</span> <span class="kw">=</span> <span class="fl">FALSE</span>
  )
}
<span class="no">fruits</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"apples"</span>, <span class="st">"pears"</span>, <span class="st">"plums"</span>, <span class="st">"apricots"</span>, <span class="st">"pineapples"</span>, <span class="st">"cherries"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">fruits</span>, <span class="no">ask_liking</span>)</pre></body></html></div>
<p>There are a couple of new functions here that you may or may not have seen before:</p>
<ul>
<li>
<code>sprintf</code> - splices variables into a template string.</li>
<li>
<code>lapply</code> - takes a function and applies it to each element of a list.</li>
</ul>
<p>Our new function <code>ask_liking</code> takes one input, <code>fruit</code>, and splices it into a standardised schema for eliciting a 7-point liking response from the participant. We apply it to each element of the vector <code>fruits</code> in turn, using the function <code>lapply</code>, and it returns the same list of elements that we had before, but with many fewer lines of code.</p>
<p>Underneath everything, many psychTestR functions operate under similar principles: they programmaticaly generate test elements according to certain schema. If designed correctly, these functions can generalise well to many different applications.</p>
</div>
<div id="modules" class="section level2">
<h2 class="hasAnchor">
<a href="#modules" class="anchor"></a>Modules</h2>
<p>In psychTestR, modules are ways of wrapping sequences of test elements into coherent logical units.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> Putting a sequence of test elements into a module has three main consequences:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Readability</strong>: It makes it clear to the reader that this sequence of test elements forms a single logical unit.</li>
<li>
<strong>Results organisation</strong>: Any results generated in this module will be assigned to a special section in the psychTestR results object, labelled with the name of the module.</li>
<li>
<strong>Protected local environment</strong>: The module will receive a fresh local environment where it can create its own local variables (see <code><a href="../reference/global_local.html">?set_local</a></code>). This local environment is protected from other modules, which is useful to avoid unexpected side effects when multiple modules are chained together.</li>
</ol>
<p>Here is a simple example of module use using the <code>ask_liking</code> function from above:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">ask_liking</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">object</span>) {
  <span class="fu"><a href="../reference/NAFC_page.html">NAFC_page</a></span>(
    <span class="no">object</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"How much do you like %s, on a scale from 1 (not at all) to 7 (lots?)"</span>,
            <span class="no">object</span>),
    <span class="kw">choices</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fl">1</span>:<span class="fl">7</span>),
    <span class="kw">arrange_vertically</span> <span class="kw">=</span> <span class="fl">FALSE</span>
  )
}

<span class="no">fruits</span> <span class="kw">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"apples"</span>, <span class="st">"pears"</span>, <span class="st">"plums"</span>)
<span class="no">animals</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"dogs"</span>, <span class="st">"cats"</span>, <span class="st">"sheep"</span>)

<span class="no">fruit_module</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/module.html">module</a></span>(
  <span class="kw">label</span> <span class="kw">=</span> <span class="st">"fruits"</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">fruits</span>, <span class="no">ask_liking</span>)
)

<span class="no">animal_module</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/module.html">module</a></span>(
  <span class="kw">label</span> <span class="kw">=</span> <span class="st">"animals"</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">animals</span>, <span class="no">ask_liking</span>)
)

<span class="no">timeline</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/join.html">join</a></span>(
  <span class="no">fruit_module</span>,
  <span class="no">animal_module</span>,
  <span class="fu"><a href="../reference/elt_save_results_to_disk.html">elt_save_results_to_disk</a></span>(<span class="kw">complete</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
  <span class="fu"><a href="../reference/final_page.html">final_page</a></span>(<span class="st">"End."</span>)
)

<span class="fu"><a href="../reference/make_test.html">make_test</a></span>(<span class="no">timeline</span>)</pre></body></html></div>
<p>If you run this code on your local computer, and complete the resulting test, then you should find your response data stored as an RDS file in <code>output/results</code>. Call <code>as.list(readRDS(file))[1:2]</code> in your R console, replacing <code>file</code> with the path to the RDS file, and you should get something like this:</p>
<pre><code>## $fruits
## $fruits$apples
## [1] "5"
## 
## $fruits$pears
## [1] "3"
## 
## $fruits$plums
## [1] "2"
## 
## 
## $animals
## $animals$dogs
## [1] "7"
## 
## $animals$cats
## [1] "5"
## 
## $animals$sheep
## [1] "3"</code></pre>
<p>As you can see, the results from the two modules have been organised into two separate sections: one labelled <code>fruits</code>, and one labelled <code>animals</code>.</p>
<p>It is often useful to wrap modules in functions that provide a degree of customisation. For example, suppose we wish to make <code>fruit_module</code> to have customisable length. We could do something like this:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">fruit_module</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">num_items</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span>(<span class="no">num_items</span> <span class="kw">&gt;</span> <span class="fl">0</span>, <span class="no">num_items</span> <span class="kw">&lt;=</span> <span class="fl">6</span>)
  <span class="no">all_fruits</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"apples"</span>, <span class="st">"pears"</span>, <span class="st">"plums"</span>, <span class="st">"apricots"</span>, <span class="st">"pineapples"</span>, <span class="st">"cherries"</span>)
  <span class="no">chosen_fruits</span> <span class="kw">&lt;-</span> <span class="no">all_fruits</span>[<span class="fl">1</span>:<span class="no">num_items</span>]
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">chosen_fruits</span>, <span class="no">ask_liking</span>)
}</pre></body></html></div>
<p>Now we can pass the desired number of items to our <code>fruit_module</code> function:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu">fruit_module</span>(<span class="fl">3</span>) <span class="co"># a module with 3 fruits</span></pre></body></html></div>
<p>In many cases modules will typically be used in one flat layer. However, it is perfectly possible to nest modules to arbitrary depths; at any point in time, only the local variables from the lowest-level module will be visible. The results object will use a composite label derived by concatenating the names of the modules, separated by periods, for example <code>parent.child.grandchild</code>.</p>
<p>Modules are not so important for one-off test implementations. However, they do become very useful when constructing batteries of multiple test implementations.</p>
</div>
<div id="packages" class="section level2">
<h2 class="hasAnchor">
<a href="#packages" class="anchor"></a>Packages</h2>
<p>A simple way of distributing R code is by sharing R source files. The new user can read this source file into their R session and take advantage of its contents: for example, this source file could provide helper functions for creating particular page types, or it could define modules implementing entire psychological tests.</p>
<p>Packages are formalised ways of sharing R source files. They stipulate particular ways of organising and documenting these source files, and they encapsulate these source files within a namespace that prevents the resulting R objects from overwriting pre-existing objects in the user’s global namespace. It is outside the scope of this tutorial to provide an introduction to package creation in R, but there are excellent tutorials available online, for example <a href="http://r-pkgs.had.co.nz/">Hadley Wickham’s ‘R packages’ book site</a>. Packages are well-suited to distributing psychTestR helper functions and modules that implement specific psychological paradigms or measures. Here are some examples of such packages:</p>
<ul>
<li>
<a href="https://pmcharrison.github.io/psychTestRCAT/">psychTestRCAT</a> - helper functions for creating adaptive tests.</li>
<li>
<a href="https://github.com/pmcharrison/mdt">mdt</a> - an adaptive melodic discrimination test.</li>
<li>
<a href="https://github.com/pmcharrison/cabat">cabat</a> - an adaptive beat perception test.</li>
<li>
<a href="https://github.com/pmcharrison/mpt">mpt</a> - an adaptive mistuning perception test.</li>
<li>
<a href="https://github.com/pmcharrison/piat">piat</a> - the ‘Pitch Imagery Arrow Task’.</li>
</ul>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p> You may have already heard of the <a href="https://cran.r-project.org/web/packages/modules/">modules</a> package in R; despite the shared name, psychTestR modules are something different.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Peter M. C. Harrison.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
